<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="mb-1 fw-bold text-dark">
                <i class="fas fa-ruler-combined text-primary me-2"></i>
                Gestión de Unidades de Medida
            </h4>
            <p class="text-muted small mb-0">Gestión de unidades para artículos</p>
        </div>
    </div>

    <!-- Buscador y botón nuevo -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text bg-white">
                    <i class="fas fa-search text-muted"></i>
                </span>
                <input type="text" class="form-control" placeholder="Buscar por nombre o símbolo..."
                    [(ngModel)]="searchTerm" (input)="onSearch()">
            </div>
        </div>
        <div class="col-md-6 text-end">
            <button class="btn btn-primary" (click)="abrirFormularioNuevo()" [disabled]="!canWrite">
                <i class="fas fa-plus me-2"></i>
                Nueva Unidad
            </button>
        </div>
    </div>

    <!-- Tabla -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div *ngIf="loading" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>

                    <div *ngIf="!loading" class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0">ID</th>
                                    <th class="border-0">Nombre</th>
                                    <th class="border-0">Símbolo</th>
                                    <th class="border-0">Factor</th>
                                    <th class="border-0 text-center">Base</th>
                                    <th class="border-0">ISO</th>
                                    <th class="border-0 text-center">Estado</th>
                                    <th class="border-0 text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngIf="unidadesFiltradas.length === 0">
                                    <td colspan="8" class="text-center text-muted py-5">
                                        No se encontraron resultados
                                    </td>
                                </tr>
                                <tr *ngFor="let u of unidadesPaginadas">
                                    <td class="align-middle"><span class="badge bg-light text-dark">{{
                                            u.id_unidad_medida }}</span></td>
                                    <td class="align-middle fw-semibold">{{ u.nombre }}</td>
                                    <td class="align-middle">{{ u.simbolo }}</td>
                                    <td class="align-middle">{{ u.factor_conversion }}</td>
                                    <td class="align-middle text-center">
                                        <i *ngIf="u.es_base" class="fas fa-check-circle text-success"></i>
                                        <span *ngIf="!u.es_base" class="text-muted">-</span>
                                    </td>
                                    <td class="align-middle">{{ u.codigo_iso || '-' }}</td>
                                    <td class="align-middle text-center">
                                        <span *ngIf="u.estado" class="badge bg-success">Activo</span>
                                        <span *ngIf="!u.estado" class="badge bg-danger">Inactivo</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" (click)="abrirFormularioEditar(u)"
                                                [disabled]="!canWrite">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" (click)="eliminar(u)"
                                                [disabled]="!canDelete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginación -->
                    <div *ngIf="!loading && unidadesFiltradas.length > 0" class="card-footer bg-white border-top">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <small class="text-muted">Página {{ currentPage }} de {{ totalPages }}</small>
                            </div>
                            <div class="col-md-6">
                                <nav>
                                    <ul class="pagination pagination-sm justify-content-md-end mb-0">
                                        <li class="page-item" [class.disabled]="currentPage === 1">
                                            <a class="page-link" (click)="cambiarPagina(currentPage - 1)"
                                                href="javascript:void(0)"><i class="fas fa-chevron-left"></i></a>
                                        </li>
                                        <li class="page-item" *ngFor="let p of pages"
                                            [class.active]="p === currentPage">
                                            <a class="page-link" (click)="cambiarPagina(p)" href="javascript:void(0)">{{
                                                p }}</a>
                                        </li>
                                        <li class="page-item" [class.disabled]="currentPage === totalPages">
                                            <a class="page-link" (click)="cambiarPagina(currentPage + 1)"
                                                href="javascript:void(0)"><i class="fas fa-chevron-right"></i></a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal" [class.show]="showForm" [style.display]="showForm ? 'flex' : 'none'" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-ruler-combined me-2"></i>
                    {{ isEditing ? 'Editar' : 'Nueva' }} Unidad
                </h5>
                <button type="button" class="btn-close" (click)="cerrarFormulario()"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Nombre <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" [(ngModel)]="formData.nombre" name="nombre"
                            placeholder="Ej: Caja x 12" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Símbolo <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" [(ngModel)]="formData.simbolo" name="simbolo"
                                placeholder="Ej: cj12" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Factor <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" [(ngModel)]="formData.factor_conversion"
                                name="factor" step="0.01">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Código ISO (Facturación)</label>
                        <input type="text" class="form-control" [(ngModel)]="formData.codigo_iso" name="iso"
                            placeholder="Ej: NIU">
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" [(ngModel)]="formData.es_base" name="es_base"
                            id="esBaseCheck">
                        <label class="form-check-label" for="esBaseCheck">Es Unidad Base</label>
                        <div class="form-text">Marcar si es la unidad de referencia (ej: Unidad, Kilo).</div>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" [(ngModel)]="formData.estado" name="estado"
                            id="estadoCheck">
                        <label class="form-check-label" for="estadoCheck">Activo</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="cerrarFormulario()">Cancelar</button>
                <button type="button" class="btn btn-primary" (click)="guardar()">Guardar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade show" *ngIf="showForm"></div>